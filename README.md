# dmidecode-in-container
Would you like to run dmidecode in Podman container or OpenShift Pod?

- dmidecode opens `/dev/mem`, so the container have to include the /dev file.
- To access /dev/mem, `SYS_RAWIO` capability is necessary.

## dmidecode in Podman container

```
sudo podman run --runtime runc --cap-add SYS_RAWIO --device /dev/mem --rm --name test ubi9 dmidecode
```

- Use `--device` to include `/dev/mem`.
- add `SYS_RAWIO` capability with `--cap-add`.

## dmidecode in OpenShift Pod

### Preparation

- There is no easy way to put /dev entry into Kubernetes Pod
  - To do that, we need Device Manager/Plugin...?
- Instead, add `/dev/mem` to `additional_devices` parameter in CRI-O config with MachineConfig.

```yaml:99-worker-devmem.yaml
# Generated by Butane; do not edit
apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: worker
  name: 99-worker-devmem
spec:
  config:
    ignition:
      version: 3.4.0
    storage:
      files:
        - contents:
            compression: ""
            source: data:;base64,W2NyaW8ucnVudGltZV0KYWRkaXRpb25hbF9kZXZpY2VzID0gWwogICAgIi9kZXYvbWVtIgpdCg==
          mode: 420
          overwrite: true
          path: /etc/crio/crio.conf.d/99-devmem
```

```
oc apply -f 99-worker-devmem.yaml
```

### Deploy

```
oc create sa sa-dmidecode
oc apply -f scc-for-dmidecode.yaml
oc adm policy add-scc-to-user for-dmidecode -z sa-dmidecode
oc apply -f deployment.yaml
oc wait --for='jsonpath={.status.readyReplicas}=1' deployment/testapp
oc exec deploy/testapp -- dmidecode | head -n 10
```

or

```
./do.sh
```

